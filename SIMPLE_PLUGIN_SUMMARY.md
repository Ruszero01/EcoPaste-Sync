# ç®€åŒ–ç‰ˆäº‘åŒæ­¥å¼•æ“æ’ä»¶ - å®Œæˆæ€»ç»“

## âœ… å®ŒæˆçŠ¶æ€

**ç®€åŒ–ç‰ˆäº‘åŒæ­¥å¼•æ“æ’ä»¶å·²æˆåŠŸæ­å»ºå¹¶é€šè¿‡æ‰€æœ‰æ£€æŸ¥ï¼**

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src-tauri/src/plugins/cloud-sync-engine/
â”œâ”€â”€ Cargo.toml                          # æ’ä»¶ä¾èµ–é…ç½®
â”œâ”€â”€ build.rs                            # æ„å»ºè„šæœ¬ (5ä¸ªå‘½ä»¤)
â”œâ”€â”€ permissions/
â”‚   â””â”€â”€ default.toml                    # æƒé™é…ç½® (5ä¸ªæƒé™)
â””â”€â”€ src/
    â”œâ”€â”€ lib.rs                          # æ’ä»¶å…¥å£
    â”œâ”€â”€ commands.rs                     # 5ä¸ªå‘½ä»¤å®ç°
    â”œâ”€â”€ sync_engine.rs                  # æ ¸å¿ƒåŒæ­¥å¼•æ“
    â””â”€â”€ types.rs                        # 4ä¸ªåŸºæœ¬ç±»å‹
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### ç®€åŒ–çš„æ¶æ„è®¾è®¡
- **1ä¸ªæ ¸å¿ƒæ¨¡å—**: `sync_engine.rs` - åŒ…å«æ‰€æœ‰åŒæ­¥é€»è¾‘
- **1ä¸ªå‘½ä»¤æ¨¡å—**: `commands.rs` - 5ä¸ªåŸºæœ¬å‘½ä»¤
- **4ä¸ªåŸºæœ¬ç±»å‹**: æœ€ç²¾ç®€çš„æ•°æ®ç»“æ„

### 5ä¸ªAPIå‘½ä»¤
1. `init_sync` - åˆå§‹åŒ–åŒæ­¥å¼•æ“
2. `start_sync` - å¯åŠ¨åŒæ­¥
3. `stop_sync` - åœæ­¢åŒæ­¥
4. `get_sync_status` - è·å–åŒæ­¥çŠ¶æ€
5. `trigger_sync` - æ‰‹åŠ¨è§¦å‘åŒæ­¥

### 4ä¸ªåŸºæœ¬ç±»å‹
```rust
enum SyncStatus { Idle, Syncing, Error }
struct SyncResult { success: bool, message: String }
struct SyncConfig { server_url: String, auto_sync: bool }
struct SyncProgress { current: u64, total: u64, percentage: f64 }
```

## ğŸ—ï¸ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶
- **CloudSyncEngine**: ç®€åŒ–çš„åŒæ­¥å¼•æ“ï¼ŒåŒ…å«çŠ¶æ€ç®¡ç†ã€é…ç½®ã€è¿›åº¦è·Ÿè¸ª
- **Arc<tokio::sync::Mutex<CloudSyncEngine>>**: çº¿ç¨‹å®‰å…¨çš„å…±äº«çŠ¶æ€
- **å¼‚æ­¥è®¾è®¡**: æ‰€æœ‰åŒæ­¥æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„

### å…³é”®ç‰¹æ€§
- âœ… çº¿ç¨‹å®‰å…¨ (ä½¿ç”¨ Arc + Tokio Mutex)
- âœ… å¼‚æ­¥ä¼˜å…ˆ (async/await)
- âœ… ç±»å‹å®‰å…¨ (å®Œæ•´çš„ç±»å‹å®šä¹‰)
- âœ… é”™è¯¯å¤„ç† (Result ç±»å‹)
- âœ… ç®€åŒ–è®¾è®¡ (æœ€å°åŒ–å¤æ‚åº¦)

## ğŸ”§ é¡¹ç›®é›†æˆ

### å·²å®Œæˆçš„é›†æˆ
- âœ… æ·»åŠ åˆ°å·¥ä½œç©ºé—´ (`Cargo.toml`)
- âœ… æ·»åŠ åˆ°ä¾èµ– (`src-tauri/Cargo.toml`)
- âœ… åˆå§‹åŒ–æ’ä»¶ (`src-tauri/src/lib.rs`)
- âœ… é…ç½®æƒé™ (`permissions/default.toml`)
- âœ… ç®¡ç†çŠ¶æ€ (`.manage(create_shared_engine())`)

### cargo check ç»“æœ
```
Finished dev profile [unoptimized + debuginfo] target(s) in 5.78s
âœ… ç¼–è¯‘é€šè¿‡ï¼Œæ— é”™è¯¯
```

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯è°ƒç”¨ (TypeScript)

```typescript
// åˆå§‹åŒ–åŒæ­¥
const result = await invoke('init_sync', {
  config: {
    server_url: 'https://example.com/webdav',
    auto_sync: true
  }
});

// å¯åŠ¨åŒæ­¥
const syncResult = await invoke('start_sync');

// è·å–çŠ¶æ€
const status = await invoke('get_sync_status');

// æ‰‹åŠ¨è§¦å‘åŒæ­¥
const triggerResult = await invoke('trigger_sync');
```

### åç«¯è°ƒç”¨ (Rust)

```rust
use tauri_plugin_eco_cloud_sync_engine::{create_shared_engine, SyncConfig};

// åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–
let sync_engine = create_shared_engine();
app.manage(sync_engine);
```

## ğŸ¨ è®¾è®¡åŸåˆ™

### ç®€åŒ–ä¼˜å…ˆ
- **æœ€å°‘çš„æ¨¡å—**: åªæœ‰ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—
- **æœ€å°‘çš„å‘½ä»¤**: åªæœ‰5ä¸ªåŸºæœ¬å‘½ä»¤
- **æœ€å°‘çš„ç±»å‹**: åªæœ‰4ä¸ªåŸºæœ¬ç±»å‹
- **æœ€ç®€å•çš„é€»è¾‘**: ç›´æ¥çš„åŒæ­¥æµç¨‹

### å¯æ‰©å±•æ€§
- ä¿ç•™äº† `TODO` æ³¨é‡Šï¼Œä¾¿äºåç»­æ‰©å±•
- æ¸…æ™°çš„æ¨¡å—ç»“æ„ï¼Œä¾¿äºæ·»åŠ æ–°åŠŸèƒ½
- æ ‡å‡†çš„ Tauri æ’ä»¶æ¶æ„ï¼Œæ˜“äºé›†æˆ

## ğŸš€ ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®

### é˜¶æ®µ1: åŸºæœ¬åŠŸèƒ½å®ç°
1. å®ç° WebDAV è¿æ¥é€»è¾‘
2. å®ç°æœ¬åœ°æ•°æ®åº“æ“ä½œ
3. å®ç°æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½

### é˜¶æ®µ2: é«˜çº§åŠŸèƒ½
1. æ·»åŠ å†²çªæ£€æµ‹
2. æ·»åŠ è¿›åº¦è·Ÿè¸ª
3. æ·»åŠ é”™è¯¯æ¢å¤

### é˜¶æ®µ3: ä¼˜åŒ–
1. æ·»åŠ ç¼“å­˜æœºåˆ¶
2. æ·»åŠ æ€§èƒ½ä¼˜åŒ–
3. æ·»åŠ ç›‘æ§æ—¥å¿—

## âœ¨ æ€»ç»“

ç®€åŒ–ç‰ˆäº‘åŒæ­¥å¼•æ“æ’ä»¶æˆåŠŸæ­å»ºå®Œæˆï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- **ç®€å•**: æœ€å°çš„æ¶æ„ï¼Œæœ€å°‘çš„ä»£ç 
- **å¯é **: é€šè¿‡æ‰€æœ‰ç¼–è¯‘æ£€æŸ¥ï¼Œæ— é”™è¯¯
- **å¯æ‰©å±•**: æ¸…æ™°çš„ç»“æ„ï¼Œä¾¿äºåç»­å¼€å‘
- **æ ‡å‡†**: éµå¾ª Tauri æ’ä»¶å¼€å‘è§„èŒƒ

Ready for development! ğŸ‰
